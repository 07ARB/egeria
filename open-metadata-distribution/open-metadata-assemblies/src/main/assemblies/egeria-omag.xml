<?xml version="1.0" encoding="UTF-8"?>

<!-- SPDX-License-Identifier: Apache-2.0 -->
<!-- Copyright Contributors to the ODPi Egeria project.  -->

<assembly xmlns="http://maven.apache.org/ASSEMBLY/2.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/ASSEMBLY/2.1.0 http://maven.apache.org/xsd/assembly-2.1.0.xsd">
    <formats>
        <format>tar.gz</format>
        <format>dir</format>
    </formats>
    <id>distribution</id>
    <baseDirectory>egeria-omag-${open-metadata.version}</baseDirectory>

    <!-- Option Include any of our third party dependencies in lib -->
    <!-- However currently each moduleset below is placing it's OWN dependencies into it's working location-->
    <!--dependencySets>
        <dependencySet>
            <useProjectArtifact>false</useProjectArtifact>
            <useTransitiveDependencies>true</useTransitiveDependencies>
            <outputDirectory>lib</outputDirectory>
            <unpack>false</unpack>
            <excludes>
                <exclude>org.odpi.egeria:*:*</exclude>
            </excludes>
        </dependencySet>
    </dependencySets!-->

    <!-- IMPORTANT: Also add ANY modules used here to the dependency in the assembly pom -->
    <moduleSets>
        <moduleSet>
            <!-- We are in the assembly tree, but we need to access modules from anywhere in the build -->
            <useAllReactorProjects>true</useAllReactorProjects>
            <!-- We only pick from this module (submodules included by default) -->
            <includes>
                <include>org.odpi.egeria:server-chassis-spring:*</include>
            </includes>
            <!-- Choose the binaries (ie jars) to includes - in this case keeping as a jar -->
            <binaries>
                <outputDirectory>./server</outputDirectory>
                <unpack>false</unpack>
                <!-- For most jars we'd include dependencies, but the chassis is already a large springboot application which includes all it needs -->
                <includeDependencies>false</includeDependencies>
            </binaries>
            <!-- Extra files from the source tree - relative to that project -->
            <sources>
                <!-- Don't include the module name under 'server' ie server-chassis-spring -->
                <includeModuleDirectory>false</includeModuleDirectory>
                <fileSets>
                    <fileSet>
                        <outputDirectory>./server/doc</outputDirectory>
                        <includes>
                            <include>README.md</include>
                        </includes>
                    </fileSet>
                    <!-- A seperate fileset for the docs so we can pull up files from src/main/resources to the top level output dir -->
                    <fileSet>
                        <outputDirectory>./server/resources</outputDirectory>
                        <directory>src/main/resources</directory>
                        <includes>
                            <include>*</include>
                        </includes>
                    </fileSet>
                </fileSets>
            </sources>
        </moduleSet>
        <!-- Pull in all of our open connectors under server/lib. -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <!-- Get ALL our connectors. Hadoop skipped for now.  TODO: review list.  -->
            <!-- avoiding wildcards means build warnings if a pattern isn't used - helpful for identifying errors -->
            <includes>
                <include>org.odpi.egeria:audit-log-console-connector:*</include>
                <include>org.odpi.egeria:audit-log-event-topic-connector:*</include>
                <include>org.odpi.egeria:audit-log-file-connector:*</include>
                <include>org.odpi.egeria:audit-log-slf4j-connector:*</include>
                <include>org.odpi.egeria:avro-file-connector:*</include>
                <include>org.odpi.egeria:basic-file-connector:*</include>
                <include>org.odpi.egeria:cassandra-data-store-connector:*</include>
                <include>org.odpi.egeria:cassandra-metadata-extractor-connector:*</include>
                <include>org.odpi.egeria:cohort-registry-file-store-connector:*</include>
                <include>org.odpi.egeria:configuration-encrypted-file-store-connector:*</include>
                <include>org.odpi.egeria:configuration-file-store-connector:*</include>
                <include>org.odpi.egeria:csv-file-connector:*</include>
                <include>org.odpi.egeria:data-folder-connector:*</include>
                <include>org.odpi.egeria:data-platform-services-connector:*</include>
                <include>org.odpi.egeria:discovery-service-connectors:*</include>
                <!--include>org.odpi.egeria:gaian-connector:*</include-->
                <include>org.odpi.egeria:graph-repository-connector:*</include>
                <include>org.odpi.egeria:inmemory-open-metadata-topic-connector:*</include>
                <include>org.odpi.egeria:inmemory-repository-connector:*</include>
                <include>org.odpi.egeria:kafka-open-metadata-topic-connector:*</include>
                <include>org.odpi.egeria:omrs-rest-repository-connector:*</include>
                <include>org.odpi.egeria:open-lineage-janus-connector:*</include>
                <include>org.odpi.egeria:open-metadata-archive-file-connector:*</include>
                <include>org.odpi.egeria:open-metadata-security-samples:*</include>
                <include>org.odpi.egeria:readonly-repository-connector:*</include>
                <!--include>org.odpi.egeria:security-officer-tag-connector:*</include-->
                <include>org.odpi.egeria:spring-rest-client-connector:*</include>
                <!--include>org.odpi.egeria:ranger-connector:*</include-->
                <!--include>org.odpi.egeria:view-generator-connectors:*</include-->
            </includes>
            <binaries>
                <outputDirectory>./server/lib</outputDirectory>
                <unpack>false</unpack>
                <!-- Assemblies can pull in dependencies via a built in mechanism -we don't need all these uber jars -->
                <includeDependencies>true</includeDependencies>
                <excludes>
                    <!-- Not needed, as the build process for each connector does not put this into the main jar artifact -->
                    <!--exclude>*jar-with-dependencies.jar</exclude-->
                </excludes>
            </binaries>
        </moduleSet>
        <!-- Utilities -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
                <include>org.odpi.egeria:cloud-information-model:*</include>
                <include>org.odpi.egeria:glossary-canonical-model:*</include>
                <include>org.odpi.egeria:open-metadata-types:*</include>
                <include>org.odpi.egeria:open-connector-archives:*</include>
            </includes>
            <binaries>
                <outputDirectory>./utilities</outputDirectory>
                <unpack>false</unpack>
                <includeDependencies>true</includeDependencies>
            </binaries>
        </moduleSet>
        <!-- Samples -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
                <include>org.odpi.egeria:admin-services-config-metadata-server-sample:*</include>
                <include>org.odpi.egeria:asset-create-avro-sample:*</include>
                <include>org.odpi.egeria:asset-create-csv-sample:*</include>
                <include>org.odpi.egeria:asset-reader-avro-sample:*</include>
                <include>org.odpi.egeria:asset-reader-csv-sample:*</include>
                <include>org.odpi.egeria:governance-leadership-sample:*</include>
                <include>org.odpi.egeria:governance-zone-create-sample:*</include>
                <include>org.odpi.egeria:subject-area-definition-sample:*</include>
                <include>org.odpi.egeria:open-connector-archives:*</include>
            </includes>
            <binaries>
                <outputDirectory>./samples</outputDirectory>
                <unpack>false</unpack>
                <includeDependencies>true</includeDependencies>
            </binaries>
            <!-- TODO: Consider if samples should have sources - or be in another assembly -->
        </moduleSet>
        <!-- Clients -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
            <include>org.odpi.egeria:asset-catalog-client:*</include>
            <include>org.odpi.egeria:asset-consumer-client:*</include>
            <include>org.odpi.egeria:asset-owner-client:*</include>
            <include>org.odpi.egeria:community-profile-client:*</include>
            <include>org.odpi.egeria:data-engine-client:*</include>
            <include>org.odpi.egeria:it-infrastructure-client:*</include>
            <include>org.odpi.egeria:it-infrastructure-client:*</include>
            <include>org.odpi.egeria:data-privacy-client:*</include>
            <include>org.odpi.egeria:data-science-client:*</include>
            <include>org.odpi.egeria:dev-ops-client:*</include>
            <include>org.odpi.egeria:digital-architecture-client:*</include>
            <include>org.odpi.egeria:discovery-engine-client:*</include>
            <include>org.odpi.egeria:governance-engine-client:*</include>
            <include>org.odpi.egeria:governance-program-client:*</include>
            <include>org.odpi.egeria:information-view-client:*</include>
            <include>org.odpi.egeria:project-management-client:*</include>
            <include>org.odpi.egeria:security-officer-client:*</include>
            <include>org.odpi.egeria:software-developer-client:*</include>
            <include>org.odpi.egeria:stewardship-action-client:*</include>
            <include>org.odpi.egeria:subject-area-client:*</include>
            <include>org.odpi.egeria:admin-services-client:*</include>
            <include>org.odpi.egeria:project-management-client:*</include>
            </includes>
            <binaries>
                <outputDirectory>./clients</outputDirectory>
                <unpack>false</unpack>
                <includeDependencies>true</includeDependencies>
            </binaries>
            <!-- TODO: Consider if samples should have sources - or be in another assembly -->
        </moduleSet>
        <!-- User Interface -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
                <include>org.odpi.egeria:ui-chassis-spring:*</include>
            </includes>
            <!-- Choose the binaries (ie jars) to includes - in this case keeping as a jar -->
            <binaries>
                <outputDirectory>./user-interface</outputDirectory>
                <unpack>false</unpack>
                <!-- For most jars we'd include dependencies, but the chassis is already a large springboot application which includes all it needs -->
                <includeDependencies>false</includeDependencies>
            </binaries>
            <!-- Extra files from the source tree - relative to that project -->
            <sources>
                <!-- Don't include the module name under 'server' ie server-chassis-spring -->
                <includeModuleDirectory>false</includeModuleDirectory>
                <fileSets>
                    <fileSet>
                        <outputDirectory>./user-interface/resources</outputDirectory>
                        <directory>src/main/resources</directory>
                        <includes>
                            <include>*</include>
                        </includes>
                    </fileSet>
                </fileSets>
            </sources>
        </moduleSet>
        <!-- Conformance Suite -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
                <include>org.odpi.egeria:open-metadata-conformance-suite-client:*</include>
            </includes>
            <binaries>
                <outputDirectory>./conformance-suite</outputDirectory>
                <unpack>false</unpack>
                <includeDependencies>true</includeDependencies>
            </binaries>
            <sources>
                <includeModuleDirectory>false</includeModuleDirectory>
                <fileSets>
                    <fileSet>
                        <outputDirectory>./conformance-suite/docs</outputDirectory>
                        <includes>
                            <include>*.md</include>
                        </includes>
                    </fileSet>
                </fileSets>
            </sources>
        </moduleSet>
        <!-- LICENSE & NOTICE and truststore from top level - this is a custom artifact -->
        <moduleSet>
            <useAllReactorProjects>true</useAllReactorProjects>
            <includes>
                <!-- Full qualification here is groupId:artifactId:packaging:classifier:version -->
                <include>org.odpi.egeria:egeria:pom:root:${open-metadata.version}</include>
            </includes>
            <sources>
                <includeModuleDirectory>false</includeModuleDirectory>
                <fileSets>
                    <fileSet>
                        <outputDirectory>.</outputDirectory>
                        <includes>
                            <include>NOTICE</include>
                            <include>LICENSE</include>
                            <include>truststore.p12</include>
                        </includes>
                    </fileSet>
                </fileSets>
            </sources>
        </moduleSet>
    </moduleSets>
</assembly>
